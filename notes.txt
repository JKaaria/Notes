Option Explicit

Sub CreateMarketInsightsDashboard()
    ' Create a new sheet for the dashboard
    Sheets.Add(After:=Sheets(Sheets.Count)).Name = "Market_Insights_Dashboard"
    Dim dashboardSheet As Worksheet
    Set dashboardSheet = Sheets("Market_Insights_Dashboard")

    ' Set up headers for the dashboard
    dashboardSheet.Cells(1, 1).Value = "Issuer"
    dashboardSheet.Cells(1, 2).Value = "Offer Amt (MM)"
    dashboardSheet.Cells(1, 3).Value = "Price (Discount)"
    dashboardSheet.Cells(1, 4).Value = "DTM"
    dashboardSheet.Cells(1, 5).Value = "Sector"

    ' Copy relevant data from "All Offerings" sheet to the dashboard
    Dim allOfferingsSheet As Worksheet
    Set allOfferingsSheet = Sheets("All Offerings")

    ' Assuming your data starts from row 2 (headers in row 1)
    Dim lastRow As Long
    lastRow = allOfferingsSheet.Cells(allOfferingsSheet.Rows.Count, "A").End(xlUp).Row

    ' Copy data from "All Offerings" to the dashboard
    allOfferingsSheet.Range("A2:AA" & lastRow).Copy Destination:=dashboardSheet.Range("A2")

    ' Add charts or visualizations as needed
    ' Example: Add a bar chart for Offer Amount
    Dim chartObj1 As ChartObject
    Set chartObj1 = dashboardSheet.ChartObjects.Add(Left:=10, Width:=375, Top:=75, Height:=225)
    chartObj1.Chart.SetSourceData Source:=dashboardSheet.Range("B2:B" & lastRow)
    chartObj1.Chart.ChartType = xlColumnClustered
    chartObj1.Chart.HasTitle = True
    chartObj1.Chart.ChartTitle.Text = "Offer Amount Distribution"

    ' Example: Add a line chart for Price (Discount)
    Dim chartObj2 As ChartObject
    Set chartObj2 = dashboardSheet.ChartObjects.Add(Left:=400, Width:=375, Top:=75, Height:=225)
    chartObj2.Chart.SetSourceData Source:=dashboardSheet.Range("C2:C" & lastRow)
    chartObj2.Chart.ChartType = xlLineMarkers
    chartObj2.Chart.HasTitle = True
    chartObj2.Chart.ChartTitle.Text = "Price (Discount) Trends"

    ' Add more visualizations as needed

    ' Add a dropdown list for sector selection
    With dashboardSheet.Shapes.AddFormControl(xlDropDown, Left:=10, Top:=10, Width:=100, Height:=20)
        .ControlFormat.AddItem "All Sectors"
        .ControlFormat.AddItem "Sector 1"
        .ControlFormat.AddItem "Sector 2"
        .ControlFormat.AddItem "Sector 3"
        .Name = "SectorDropdown"
    End With

    ' Add a button to apply filters
    With dashboardSheet.Buttons.Add(Left:=120, Top:=10, Width:=80, Height:=20)
        .OnAction = "ApplyFilters"
        .Caption = "Apply Filters"
        .Name = "ApplyFiltersButton"
    End With

    ' Make the dashboard sheet the active sheet
    dashboardSheet.Activate
End Sub

Sub ApplyFilters()
    ' Apply filters based on the selected sector
    Dim dashboardSheet As Worksheet
    Set dashboardSheet = Sheets("Market_Insights_Dashboard")

    ' Get the selected sector from the dropdown
    Dim sectorDropdown As Shape
    Set sectorDropdown = dashboardSheet.Shapes("SectorDropdown")
    Dim selectedSector As String
    selectedSector = sectorDropdown.ControlFormat.List(sectorDropdown.ControlFormat.ListIndex)

    ' Apply filters based on the selected sector
    If selectedSector <> "All Sectors" Then
        dashboardSheet.Rows("2:" & dashboardSheet.Rows.Count).AutoFilter Field:=5, Criteria1:=selectedSector
    Else
        dashboardSheet.AutoFilterMode = False ' Clear filters if "All Sectors" is selected
    End If
End Sub
