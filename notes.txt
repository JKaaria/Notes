Sub MergeAndSplitTextToColumnsOnCurrentWorkbook()
    Dim originalData As Variant
    Dim mergedData As Variant
    Dim numRows As Long, numCols As Long
    Dim i As Long, j As Long
    Dim mergedColumn As Long
    Dim previousRow As Long
    
    ' Assuming the data is in the active sheet, adjust if needed
    With ActiveSheet
        ' Find the last row and column with data
        numRows = .Cells(.Rows.Count, 1).End(xlUp).Row
        numCols = .Cells(1, .Columns.Count).End(xlToLeft).Column
        
        ' Read data into an array
        originalData = .Range(.Cells(1, 1), .Cells(numRows, numCols)).Value
    End With
    
    ' Create a new array to store merged data
    ReDim mergedData(1 To numRows, 1 To 1)
    
    ' Loop through each row to merge data into a single column
    For i = 1 To numRows
        ' Initialize the merged column
        mergedColumn = 1
        
        ' Loop through each column to concatenate data
        For j = 1 To numCols
            mergedData(i, mergedColumn) = mergedData(i, mergedColumn) & originalData(i, j)
            
            ' Add a delimiter if not the last column
            If j < numCols Then
                mergedData(i, mergedColumn) = mergedData(i, mergedColumn) & ","
            End If
        Next j
        
        ' Check if the merged data in the current row makes sense in the context of the previous row
        If i > 1 Then
            If Not ValidateMergedData(mergedData(i, mergedColumn), mergedData(previousRow, mergedColumn)) Then
                ' Handle misalignment - you can add your logic here (e.g., prompt user, log error, etc.)
                MsgBox "Misalignment detected in Row " & i & ". Please check the data.", vbExclamation
                Exit Sub
            End If
        End If
        
        ' Update the previous row
        previousRow = i
    Next i
    
    ' Clear existing data in the sheet
    ActiveSheet.Cells.Clear
    
    ' Paste the merged data into the sheet
    ActiveSheet.Range("A1").Resize(numRows, 1).Value = mergedData
    
    ' Split the merged data into columns using text to columns
    ActiveSheet.Columns("A:A").TextToColumns Destination:=Range("A1"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=True, Space:=False, Other:=False
    
    MsgBox "Data merged and split successfully in the current workbook!", vbInformation
End Sub

Function ValidateMergedData(currentRowData As Variant, previousRowData As Variant) As Boolean
    ' Add your validation logic here
    ' You may compare the current row data with the previous row data to check for misalignment
    ' Return True if the data is aligned, False otherwise
    
    ' For example, you can check if the length of the current row data is greater than the previous row data
    ' Modify this logic based on your specific requirements
    
    Dim currentLength As Long
    Dim previousLength As Long
    
    ' Convert the variant data to a string for length comparison
    currentLength = Len(CStr(currentRowData))
    previousLength = Len(CStr(previousRowData))
    
    ' Compare the length of the current row data with the previous row data
    ValidateMergedData = currentLength >= previousLength
End Function
