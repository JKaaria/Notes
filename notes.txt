Sub CreateMarketInsightsAndOpportunities()
    ' Declare variables
    Dim wsData As Worksheet
    Dim wsDashboard As Worksheet
    Dim rngData As Range
    Dim chartLocation As Range
    Dim creditRatingFields As Variant
    Dim lastRow As Long
    Dim creditRating As String

    ' Set references to worksheets
    On Error Resume Next
    Set wsData = ThisWorkbook.Sheets("All Offerings")
    On Error GoTo 0

    If wsData Is Nothing Then
        MsgBox "Sheet 'All Offerings' not found!", vbExclamation
        Exit Sub
    End If

    ' Set the range for data
    lastRow = wsData.Cells(wsData.Rows.Count, "A").End(xlUp).Row
    Set rngData = wsData.Range("A1:AI" & lastRow)

    ' Create a new worksheet for the dashboard
    Set wsDashboard = ThisWorkbook.Sheets.Add(After:=Sheets(Sheets.Count))
    wsDashboard.Name = "Market Insights and Opportunities"

    ' Define credit rating fields
    creditRatingFields = Split("S and P,Moody,Fitch", ",")

    ' Create charts and tables
    ' Example 1: Offer Amount vs. Discount Price
    Set chartLocation = wsDashboard.Range("A1")
    CreateScatterChart rngData, chartLocation, "Offer Amt (MM)", "Price (Discount)"

    ' Example 2: Maturity Distribution
    Set chartLocation = wsDashboard.Range("G1")
    CreateColumnChart rngData, chartLocation, "Maturity Date", "Offer Amt (MM)", "Maturity Distribution"

    ' Example 3: Credit Ratings Distribution
    Set chartLocation = wsDashboard.Range("M1")
    CreateBarChart rngData, chartLocation, creditRatingFields, "Count of Offerings by Credit Rating"

    ' Example 4: Sector-wise Distribution
    Set chartLocation = wsDashboard.Range("S1")
    CreatePieChart rngData, chartLocation, "Sector", "Sector-wise Distribution"

    ' Business Opportunities Section
    wsDashboard.Cells(1, 25).Value = "Business Opportunities"
    wsDashboard.Cells(2, 25).Value = "Issuer"
    wsDashboard.Cells(2, 26).Value = "Potential Opportunity"

    ' Loop through data to identify potential opportunities
    For i = 2 To lastRow
        creditRating = wsData.Cells(i, 9).Value ' Assuming credit rating is in column I (9th column)
        If IsInArray(creditRating, creditRatingFields) Then
            ' Add logic to identify specific conditions for business opportunities
            ' For example, consider issuing more commercial paper for highly rated issuers
            wsDashboard.Cells(wsDashboard.Cells(wsDashboard.Rows.Count, 25).End(xlUp).Row + 1, 25).Value = wsData.Cells(i, 1).Value ' Issuer name
            wsDashboard.Cells(wsDashboard.Cells(wsDashboard.Rows.Count, 26).End(xlUp).Row, 26).Value = "High Credit Rating - Explore Opportunities"
        End If
    Next i

    MsgBox "Market Insights and Opportunities Dashboard Created Successfully!", vbInformation
End Sub

Function IsInArray(valToBeFound As Variant, arr As Variant) As Boolean
    ' Function to check if a value is in an array
    Dim element As Variant
    For Each element In arr
        If element = valToBeFound Then
            IsInArray = True
            Exit Function
        End If
    Next element
    IsInArray = False
End Function
