
Sub CheckTradeIDs()
    Dim wsTradeData As Worksheet
    Dim wsT0WIBookings As Worksheet
    Dim lastRowTradeData As Long
    Dim tradeIDCol As Range
    Dim tradeIDColumnIndexTradeData As Long
    Dim tradeIDColumnIndexT0WIBookings As Long
    Dim cell As Range
    
    ' Set the worksheets
    Set wsTradeData = ThisWorkbook.Sheets("TradeData")
    Set wsT0WIBookings = ThisWorkbook.Sheets("T+0 WI Bookings")
    
    ' Find the last row in the TradeData sheet
    lastRowTradeData = wsTradeData.Cells(wsTradeData.Rows.Count, 1).End(xlUp).Row
    
    ' Find the column index of the "Trade ID" column in TradeData sheet (assumes it's in the first row)
    tradeIDColumnIndexTradeData = FindColumnIndex(wsTradeData, "Trade ID")
    
    ' Check if "Trade ID" column was found in TradeData sheet
    If tradeIDColumnIndexTradeData = 0 Then
        MsgBox "The 'Trade ID' column was not found in TradeData sheet.", vbExclamation
        Exit Sub
    End If
    
    ' Set the range for the "Trade ID" column in TradeData sheet
    Set tradeIDCol = wsTradeData.Range(wsTradeData.Cells(2, tradeIDColumnIndexTradeData), wsTradeData.Cells(lastRowTradeData, tradeIDColumnIndexTradeData))
    
    ' Find the column index of the "Trade ID" column in T+0 WI Bookings sheet (assumes it's in the first row)
    tradeIDColumnIndexT0WIBookings = FindColumnIndex(wsT0WIBookings, "Trade ID")
    
    ' Check if "Trade ID" column was found in T+0 WI Bookings sheet
    If tradeIDColumnIndexT0WIBookings = 0 Then
        MsgBox "The 'Trade ID' column was not found in T+0 WI Bookings sheet.", vbExclamation
        Exit Sub
    End If
    
    ' Loop through each cell in the "Trade ID" column in TradeData sheet
    For Each cell In tradeIDCol
        ' Check if the current cell's value is in the "T+0 WI Bookings" sheet
        If Not IsError(Application.Match(cell.Value, wsT0WIBookings.Columns(tradeIDColumnIndexT0WIBookings), 0)) Then
            ' Display a pop-up message with the matching Trade ID
            MsgBox "Matching Trade ID found: " & cell.Value, vbInformation
        End If
    Next cell
End Sub

Function FindColumnIndex(ws As Worksheet, header As String) As Long
    ' Find the column index based on the header in the first row of the worksheet
    Dim i As Long
    For i = 1 To ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column
        If ws.Cells(1, i).Value = header Then
            FindColumnIndex = i
            Exit Function
        End If
    Next i
    ' Return 0 if the header is not found
    FindColumnIndex = 0
End Function
