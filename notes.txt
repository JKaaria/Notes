Sub SplitTextToColumnsAndAlign()
    Dim lastRow As Long
    Dim lastCol As Long
    Dim currentRow As Long
    Dim currentCol As Long
    Dim targetCommaCount As Long
    Dim cellValue As String
    Dim commaCount As Long
    Dim headerCommaCount As Long
    
    ' Find the last row and column with data
    lastRow = ActiveSheet.Cells(ActiveSheet.Rows.Count, 1).End(xlUp).Row
    lastCol = ActiveSheet.Cells(1, ActiveSheet.Columns.Count).End(xlToLeft).Column
    
    ' Count the number of commas in the header row
    headerCommaCount = Len(ActiveSheet.Cells(1, 1).Value) - Len(Replace(ActiveSheet.Cells(1, 1).Value, ",", ""))
    
    ' Iterate through each row
    For currentRow = 2 To lastRow
        ' Iterate through each column in the current row
        For currentCol = 1 To lastCol
            ' Get the cell value in the current cell
            cellValue = ActiveSheet.Cells(currentRow, currentCol).Value
            
            ' Count the number of commas in the cell value
            commaCount = Len(cellValue) - Len(Replace(cellValue, ",", ""))
            
            ' Determine the target number of commas based on the header row
            targetCommaCount = headerCommaCount
            
            ' Add or remove commas to match the target number
            Do While commaCount < targetCommaCount
                ' Add commas
                cellValue = cellValue & ","
                commaCount = commaCount + 1
            Loop
            
            Do While commaCount > targetCommaCount
                ' Remove commas
                cellValue = Left(cellValue, InStrRev(cellValue, ",") - 1) & Mid(cellValue, InStrRev(cellValue, ",") + 1)
                commaCount = commaCount - 1
            Loop
            
            ' Set the modified cell value back to the cell
            ActiveSheet.Cells(currentRow, currentCol).Value = cellValue
        Next currentCol
    Next currentRow
    
    MsgBox "Text split to columns and aligned successfully!", vbInformation
End Sub
