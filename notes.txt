Sub RatingAnalysis()
    Dim wsAllOfferings As Worksheet
    Dim wsOverview As Worksheet
    Dim lastRow As Long
    Dim ratings As Variant
    Dim rating As Variant
    Dim ratingCounts As Collection
    Dim ratingColors As Collection
    Dim i As Long
    Dim nextRow As Long
    
    ' Set references to worksheets
    Set wsAllOfferings = ThisWorkbook.Sheets("All Offerings")
    
    ' Check if "Overview" sheet exists, if not, create it
    On Error Resume Next
    Set wsOverview = ThisWorkbook.Sheets("Overview")
    On Error GoTo 0
    If wsOverview Is Nothing Then
        Set wsOverview = ThisWorkbook.Sheets.Add(After:=Sheets(Sheets.Count))
        wsOverview.Name = "Overview"
    End If
    
    ' Find the next available row in "Overview" sheet
    nextRow = wsOverview.Cells(wsOverview.Rows.Count, "A").End(xlUp).Row + 1
    
    ' Set headers in "Overview" sheet if the sheet is empty
    If nextRow = 2 Then
        wsOverview.Range("I1").Value = "Rating Analysis"
        wsOverview.Range("I2").Value = "Rating"
        wsOverview.Range("J2").Value = "Count"
    End If
    
    ' Set reference to unique ratings using Collection
    Set ratingCounts = New Collection
    Set ratingColors = New Collection
    
    ' Find the last row in column A of "All Offerings" sheet
    lastRow = wsAllOfferings.Cells(wsAllOfferings.Rows.Count, "A").End(xlUp).Row
    
    ' Loop through each row in "All Offerings" sheet
    For i = 2 To lastRow ' Assuming headers are in the first row
        ' Get ratings from columns H, I, J, and K (assuming H, I, J, K are the column numbers for Reg Type, S&P, Moody's, Fitch)
        ratings = Array(wsAllOfferings.Cells(i, 8).Value, wsAllOfferings.Cells(i, 9).Value, wsAllOfferings.Cells(i, 10).Value, wsAllOfferings.Cells(i, 11).Value)
        For Each rating In ratings
            ' Check if rating is not empty
            If Trim(rating) <> "" Then
                ' Update count for the rating
                On Error Resume Next
                ratingCounts.Add rating, CStr(rating)
                On Error GoTo 0
            End If
        Next rating
    Next i
    
    ' Populate data in "Overview" sheet starting from the next available row
    For i = 1 To ratingCounts.Count
        wsOverview.Cells(nextRow, 9).Value = ratingCounts(i)
        wsOverview.Cells(nextRow, 10).Value = Application.WorksheetFunction.CountIf(wsAllOfferings.Range("H:H|I:I|J:J|K:K"), ratingCounts(i))
        nextRow = nextRow + 1
    Next i
    
    ' Set conditional formatting for the count column
    With wsOverview.Range("J3").Resize(ratingCounts.Count, 1).FormatConditions.Add(Type:=xlCellValue, Operator:=xlGreaterEqual, Formula1:="1")
        .Interior.Color = RGB(0, 255, 0)
    End With
End Sub
