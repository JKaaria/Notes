Sub RenameCounterpartyIDToSDS()

    ' Define variables
    Dim wsTrade As Worksheet
    Dim counterpartyIDCol As Range
    
    ' Set worksheet
    Set wsTrade = ThisWorkbook.Sheets("TradeData") ' Replace "TradeData" with the actual name of your sheet
    
    ' Find "Counterparty ID" header
    Set counterpartyIDCol = wsTrade.Rows(1).Find("Counterparty ID", LookIn:=xlValues, LookAt:=xlWhole)
    
    ' Check if "Counterparty ID" header exists
    If Not counterpartyIDCol Is Nothing Then
        ' Rename the header to "SDS"
        counterpartyIDCol.Value = "SDS"
        
        MsgBox "Counterparty ID header amended to SDS!", vbInformation
    Else
        MsgBox "Counterparty ID header not found!", vbExclamation
    End If

End Sub

Sub RenameCounterpartyIDToSDS()

    ' Define variables
    Dim wsTrade As Worksheet
    Dim counterpartyIDCol As Range
    
    ' Set worksheet
    Set wsTrade = ThisWorkbook.Sheets("TradeData") ' Replace "TradeData" with the actual name of your sheet
    
    ' Find "Counterparty ID" header
    Set counterpartyIDCol = wsTrade.Rows(1).Find("Counterparty ID", LookIn:=xlValues, LookAt:=xlWhole)
    
    ' Check if "Counterparty ID" header exists
    If Not counterpartyIDCol Is Nothing Then
        ' Rename the header to "SDS"
        counterpartyIDCol.Value = "SDS"
        
        MsgBox "Counterparty ID header amended to SDS!", vbInformation
    Else
        MsgBox "Counterparty ID header not found!", vbExclamation
    End If

End Sub

Sub CopyMatchingSDSValues()

    ' Define variables
    Dim wsTrade As Worksheet
    Dim wsLogic As Worksheet
    Dim wsResult As Worksheet
    Dim lastRowTrade As Long
    Dim lastRowLogic As Long
    Dim tradeSDSCol As Integer
    Dim logicSDSCol As Integer
    Dim resultRow As Long
    
    ' Set worksheets
    Set wsTrade = ThisWorkbook.Sheets("TradeData")
    Set wsLogic = ThisWorkbook.Sheets("LogicTable")
    
    ' Create or reference "ResultSheet" sheet
    On Error Resume Next
    Set wsResult = ThisWorkbook.Sheets("ResultSheet")
    On Error GoTo 0
    
    If wsResult Is Nothing Then
        ' If "ResultSheet" sheet doesn't exist, create it
        Set wsResult = ThisWorkbook.Sheets.Add(After:=Sheets(Sheets.Count))
        wsResult.Name = "ResultSheet"
    End If
    
    ' Set column numbers based on headers
    tradeSDSCol = WorksheetFunction.Match("SDS", wsTrade.Rows(1), 0)
    logicSDSCol = WorksheetFunction.Match("SDS", wsLogic.Rows(1), 0)
    
    ' Find the last rows in each sheet
    lastRowTrade = wsTrade.Cells(wsTrade.Rows.Count, tradeSDSCol).End(xlUp).Row
    lastRowLogic = wsLogic.Cells(wsLogic.Rows.Count, logicSDSCol).End(xlUp).Row
    
    ' Initialize row number for ResultSheet
    resultRow = 1
    
    ' Loop through TradeData sheet
    For i = 2 To lastRowTrade
        ' Search for SDS value in LogicTable
        Dim foundCell As Range
        Set foundCell = wsLogic.Columns(logicSDSCol).Find(wsTrade.Cells(i, tradeSDSCol).Value, LookIn:=xlValues, LookAt:=xlWhole)
        
        ' If a match is found, copy relevant information to ResultSheet
        If Not foundCell Is Nothing Then
            wsResult.Cells(resultRow, 1).Value = wsTrade.Cells(i, tradeSDSCol).Value ' SDS
            wsResult.Cells(resultRow, 2).Value = wsTrade.Cells(i, WorksheetFunction.Match("Account Legal Name", wsTrade.Rows(1), 0)).Value ' Account Legal Name
            wsResult.Cells(resultRow, 3).Value = wsTrade.Cells(i, WorksheetFunction.Match("Trade ID", wsTrade.Rows(1), 0)).Value ' Trade ID
            wsResult.Cells(resultRow, 4).Value = wsTrade.Cells(i, WorksheetFunction.Match("Entity", wsTrade.Rows(1), 0)).Value ' Entity from TradeData
            wsResult.Cells(resultRow, 5).Value = wsLogic.Cells(foundCell.Row, WorksheetFunction.Match("Entity", wsLogic.Rows(1), 0)).Value ' Entity from LogicTable
            resultRow = resultRow + 1
        End If
    Next i
    
    MsgBox "Matching SDS values copied to ResultSheet!", vbInformation

End Sub
