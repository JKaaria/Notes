Sub ApplyVLookup()

    Dim wsOpenFISS As Worksheet
    Dim wsInventory As Worksheet
    Dim openFISSColumn As Range
    Dim vlookupFormula As String

    ' Set references to worksheets
    Set wsOpenFISS = ThisWorkbook.Sheets("Open FISS Trades")
    Set wsInventory = ThisWorkbook.Sheets("Inventory")

    ' Search for the "Contract Reference" column header in the "Open FISS Trades" sheet
    Set openFISSColumn = wsOpenFISS.Rows(1).Find("Contract Reference", LookIn:=xlValues, LookAt:=xlWhole)

    ' Check if the column header is found
    If Not openFISSColumn Is Nothing Then
        ' Construct the VLOOKUP formula
        vlookupFormula = "=VLOOKUP(U2, " & wsInventory.Name & "!A:Z, " & openFISSColumn.Column & ", FALSE)"

        ' Apply the VLOOKUP formula to the cell in the next column after the "Contract Reference" column
        wsOpenFISS.Cells(2, openFISSColumn.Column + 1).Formula = vlookupFormula

        MsgBox "VLOOKUP formula applied successfully!", vbInformation
    Else
        MsgBox "Column header 'Contract Reference' not found in 'Open FISS Trades' sheet.", vbExclamation
    End If

End Sub
 
