Sub AnalyseRatings()
    Dim wsAllOfferings As Worksheet
    Dim wsOverview As Worksheet
    Dim lastRow As Long
    Dim uniqueRegTypes As Collection
    Dim regType As Variant
    Dim countSP As Long, countMoody As Long, countFitch As Long
    Dim i As Long
    
    ' Set worksheets
    Set wsAllOfferings = ThisWorkbook.Sheets("All Offerings")
    Set wsOverview = ThisWorkbook.Sheets("Overview")
    
    ' Clear previous data in Overview sheet
    wsOverview.Range("I:O").Clear
    
    ' Find the last row in All Offerings sheet
    lastRow = wsAllOfferings.Cells(wsAllOfferings.Rows.Count, "A").End(xlUp).Row
    
    ' Initialize collections
    Set uniqueRegTypes = New Collection
    
    ' Loop through All Offerings sheet to gather unique regulatory types
    On Error Resume Next
    For i = 2 To lastRow ' Assuming headers are in row 1
        uniqueRegTypes.Add wsAllOfferings.Cells(i, "H").Value, CStr(wsAllOfferings.Cells(i, "H").Value)
    Next i
    On Error GoTo 0
    
    ' Loop through unique regulatory types and count issuances
    For Each regType In uniqueRegTypes
        countSP = 0
        countMoody = 0
        countFitch = 0
        
        For i = 2 To lastRow
            If CStr(wsAllOfferings.Cells(i, "H").Value) = regType Then
                If Not IsEmpty(wsAllOfferings.Cells(i, "I").Value) Then
                    countSP = countSP + 1
                End If
                
                If Not IsEmpty(wsAllOfferings.Cells(i, "J").Value) Then
                    countMoody = countMoody + 1
                End If
                
                If Not IsEmpty(wsAllOfferings.Cells(i, "K").Value) Then
                    countFitch = countFitch + 1
                End If
            End If
        Next i
        
        ' Write results to Overview sheet
        wsOverview.Cells(wsOverview.Rows.Count, "I").End(xlUp).Offset(1, 0).Value = regType
        wsOverview.Cells(wsOverview.Rows.Count, "J").End(xlUp).Offset(1, 0).Value = countSP
        wsOverview.Cells(wsOverview.Rows.Count, "K").End(xlUp).Offset(1, 0).Value = countMoody
        wsOverview.Cells(wsOverview.Rows.Count, "L").End(xlUp).Offset(1, 0).Value = countFitch
    Next regType
End Sub
