Sub GenerateCommercialPaperAnalysis()

    ' Load data from "All Offerings" sheet
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("All Offerings")

    ' Data Cleaning and Formatting
    Call CleanAndFormatData(ws)

    ' Create a new sheet for analysis
    Dim analysisWs As Worksheet
    Set analysisWs = ThisWorkbook.Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
    analysisWs.Name = "CommercialPaperAnalysis"

    ' Overview Sheet
    Call CreateOverviewSheet(ws, analysisWs)

    ' Sector Analysis
    Call CreateSectorAnalysisChart(ws, analysisWs)

    ' Rating Analysis
    Call CreateRatingAnalysisChart(ws, analysisWs)

    ' Issuer-wise Analysis
    Call CreateIssuerAnalysisChart(ws, analysisWs)

    ' Coupon vs. Maturity Date
    Call CreateCouponVsMaturityChart(ws, analysisWs)

    ' Time Series Analysis
    Call CreateTimeSeriesAnalysisChart(ws, analysisWs)

    MsgBox "Commercial Paper Analysis is complete!", vbInformation

End Sub

Sub CleanAndFormatData(ws As Worksheet)
    ' Data Cleaning and Formatting
    ws.Cells.Clear
    ' Add your data loading and cleaning logic here
End Sub

Sub CreateOverviewSheet(ws As Worksheet, analysisWs As Worksheet)
    ' Overview Sheet
    analysisWs.Cells.Clear
    analysisWs.Name = "Overview"
    analysisWs.Range("A1:B1").Value = Array("Metric", "Value")
    analysisWs.Range("A2").Value = "Total Value of Offerings"
    analysisWs.Range("B2").Formula = "=SUM('" & ws.Name & "'!C2)"
    ' Add more key metrics as needed
End Sub

Sub CreateSectorAnalysisChart(ws As Worksheet, analysisWs As Worksheet)
    ' Sector Analysis
    Dim sectorChart As ChartObject
    Set sectorChart = analysisWs.ChartObjects.Add(Left:=10, Width:=375, Top:=80, Height:=225)
    sectorChart.Chart.SetSourceData ws.Range("C2:C" & ws.Cells(ws.Rows.Count, "C").End(xlUp).Row)
    sectorChart.Chart.ChartType = xlColumnClustered
    sectorChart.Chart.HasTitle = True
    sectorChart.Chart.ChartTitle.Text = "Sector Analysis"
    sectorChart.Chart.Axes(xlCategory, xlPrimary).HasTitle = True
    sectorChart.Chart.Axes(xlCategory, xlPrimary).AxisTitle.Text = "Sector"
    sectorChart.Chart.Axes(xlValue, xlPrimary).HasTitle = True
    sectorChart.Chart.Axes(xlValue, xlPrimary).AxisTitle.Text = "Number of Offerings"
End Sub

Sub CreateRatingAnalysisChart(ws As Worksheet, analysisWs As Worksheet)
    ' Rating Analysis
    Dim ratingChart As ChartObject
    Set ratingChart = analysisWs.ChartObjects.Add(Left:=400, Width:=375, Top:=80, Height:=225)
    ratingChart.Chart.SetSourceData ws.Range("H2:H" & ws.Cells(ws.Rows.Count, "H").End(xlUp).Row)
    ratingChart.Chart.ChartType = xlColumnClustered
    ratingChart.Chart.HasTitle = True
    ratingChart.Chart.ChartTitle.Text = "Rating Analysis"
    ratingChart.Chart.Axes(xlCategory, xlPrimary).HasTitle = True
    ratingChart.Chart.Axes(xlCategory, xlPrimary).AxisTitle.Text = "Rating Agency"
    ratingChart.Chart.Axes(xlValue, xlPrimary).HasTitle = True
    ratingChart.Chart.Axes(xlValue, xlPrimary).AxisTitle.Text = "Number of Offerings"
End Sub

Sub CreateIssuerAnalysisChart(ws As Worksheet, analysisWs As Worksheet)
    ' Issuer-wise Analysis
    Dim issuerChart As ChartObject
    Set issuerChart = analysisWs.ChartObjects.Add(Left:=10, Width:=375, Top:=350, Height:=225)
    issuerChart.Chart.SetSourceData ws.Range("A2:A" & ws.Cells(ws.Rows.Count, "A").End(xlUp).Row)
    issuerChart.Chart.ChartType = xlColumnClustered
    issuerChart.Chart.HasTitle = True
    issuerChart.Chart.ChartTitle.Text = "Issuer-wise Analysis"
    issuerChart.Chart.Axes(xlCategory, xlPrimary).HasTitle = True
    issuerChart.Chart.Axes(xlCategory, xlPrimary).AxisTitle.Text = "Issuer"
    issuerChart.Chart.Axes(xlValue, xlPrimary).HasTitle = True
    issuerChart.Chart.Axes(xlValue, xlPrimary).AxisTitle.Text = "Number of Offerings"
End Sub

Sub CreateCouponVsMaturityChart(ws As Worksheet, analysisWs As Worksheet)
    ' Coupon vs. Maturity Date
    Dim scatterChart As ChartObject
    Set scatterChart = analysisWs.ChartObjects.Add(Left:=400, Width:=375, Top:=350, Height:=225)
    scatterChart.Chart.SetSourceData ws.Range("E2:E" & ws.Cells(ws.Rows.Count, "E").End(xlUp).Row & ",F2:F" & ws.Cells(ws.Rows.Count, "F").End(xlUp).Row & ",H2:H" & ws.Cells(ws.Rows.Count, "H").End(xlUp).Row)
    scatterChart.Chart.ChartType = xlXYScatterLines
    scatterChart.Chart.HasTitle = True
    scatterChart.Chart.ChartTitle.Text = "Coupon vs. Maturity Date"
    scatterChart.Chart.Axes(xlCategory, xlPrimary).HasTitle = True
    scatterChart.Chart.Axes(xlCategory, xlPrimary).AxisTitle.Text = "Maturity Date"
    scatterChart.Chart.Axes(xlValue, xlPrimary).HasTitle = True
    scatterChart.Chart.Axes(xlValue, xlPrimary).AxisTitle.Text = "Coupon"
    scatterChart.Chart.Axes(xlValue, xlSecondary).HasTitle = True
    scatterChart.Chart.Axes(xlValue, xlSecondary).AxisTitle.Text = "Sector"
    scatterChart.Chart.SeriesCollection(3).AxisGroup = xlSecondary
End Sub

Sub CreateTimeSeriesAnalysisChart(ws As Worksheet, analysisWs As Worksheet)
    ' Time Series Analysis
    Dim timeSeriesChart As ChartObject
    Set timeSeriesChart = analysisWs.ChartObjects.Add(Left:=10, Width:=750, Top:=620, Height:=225)
    timeSeriesChart.Chart.SetSourceData ws.Range("U2:U" & ws.Cells(ws.Rows.Count, "U").End(xlUp).Row & ",V2:V" & ws.Cells(ws.Rows.Count, "V").End(xlUp).Row)
    timeSeriesChart.Chart.ChartType = xlLineMarkers
    timeSeriesChart.Chart.HasTitle = True
    timeSeriesChart.Chart.ChartTitle.Text = "Time Series Analysis"
    timeSeriesChart.Chart.Axes(xlCategory, xlPrimary).HasTitle = True
    timeSeriesChart.Chart.Axes(xlCategory, xlPrimary).AxisTitle.Text = "Offer Date"
    timeSeriesChart.Chart.Axes(xlValue, xlPrimary).HasTitle = True
    timeSeriesChart.Chart.Axes(xlValue, xlPrimary).AxisTitle.Text = "Total Value of Offerings (MM)"
End Sub
