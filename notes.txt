Sub AnalyseRatings()
    ' Define variables
    Dim wsAllOfferings As Worksheet
    Dim wsOverview As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim clientCategories As Collection
    Dim category As Variant
    
    ' Set references to sheets
    Set wsAllOfferings = ThisWorkbook.Sheets("All Offerings")
    Set wsOverview = ThisWorkbook.Sheets("Overview")
    
    ' Find the last row in the All Offerings sheet
    lastRow = wsAllOfferings.Cells(wsAllOfferings.Rows.Count, "A").End(xlUp).Row
    
    ' Initialize collection for unique client categories
    Set clientCategories = New Collection
    
    ' Loop through data in All Offerings sheet
    For i = 2 To lastRow ' Assuming headers are in row 1
        ' Collect unique client categories
        clientCategories.Add wsAllOfferings.Cells(i, 8).Value, CStr(wsAllOfferings.Cells(i, 8).Value)
    Next i
    
    ' Write data to Overview sheet
    wsOverview.Range("I:L").Clear ' Clear existing data in columns I to L
    
    ' Write headers
    wsOverview.Range("I1").Value = "Reg Type" ' Rename cell I1 as "Reg Type"
    wsOverview.Range("J1").Value = "Average Rating (S&P)"
    wsOverview.Range("K1").Value = "Average Rating (Moody)"
    wsOverview.Range("L1").Value = "Average Rating (Fitch)"
    
    ' Loop through unique client categories and calculate averages using formulas
    For Each category In clientCategories
        ' Find row in Overview sheet
        Dim overviewRow As Long
        overviewRow = wsOverview.Cells(wsOverview.Rows.Count, "I").End(xlUp).Row + 1
        
        ' Write client category to Overview sheet
        wsOverview.Cells(overviewRow, 9).Value = category
        
        ' Calculate averages using formulas
        wsOverview.Cells(overviewRow, 10).Formula = "=AVERAGEIFS('All Offerings'!I:I, 'All Offerings'!H:H, """ & category & """, 'All Offerings'!A:A, ""<>*#"")"
        wsOverview.Cells(overviewRow, 11).Formula = "=AVERAGEIFS('All Offerings'!J:J, 'All Offerings'!H:H, """ & category & """, 'All Offerings'!A:A, ""<>*#"")"
        wsOverview.Cells(overviewRow, 12).Formula = "=AVERAGEIFS('All Offerings'!K:K, 'All Offerings'!H:H, """ & category & """, 'All Offerings'!A:A, ""<>*#"")"
    Next category
    
    ' Convert formulas to values (optional)
    wsOverview.Range("J:L").Value = wsOverview.Range("J:L").Value
End Sub
