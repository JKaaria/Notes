Sub Seven()
    ' Define variables
    Dim wResult As Worksheet
    Dim lastRowResult As Long
    Dim outlookApp As Object
    Dim outlookMail As Object
    Dim emailBody As String
    
    ' Set worksheet
    Set wResult = ThisWorkbook.Sheets("ResultSheet")
    
    ' Find the last row in ResultSheet
    lastRowResult = wResult.Cells(wResult.Rows.Count, 1).End(xlUp).Row
    
    ' Add helper column in column I with formula to check for mismatch
    wResult.Columns("I:I").Formula = "=IF(D2<>E2,1,0)"
    
    ' Filter based on helper column value (1 for mismatch)
    wResult.AutoFilterMode = False ' Clear existing filters
    wResult.Rows(1).AutoFilter Field:=9, Criteria1:=1 ' Field 9 corresponds to column I
    
    ' Initialize email body
    emailBody = "Mismatching Entities Details:" & vbCrLf & vbCrLf
    
    ' Loop through visible (filtered) rows to check for matching entities
    For i = 2 To lastRowResult
        If wResult.Rows(i).Hidden = False Then
            ' Add details of mismatching row to email body
            emailBody = emailBody & "Row " & i & ": Entities do not match." & vbCrLf & _
                         "SDS: " & wResult.Cells(i, 1).Value & vbCrLf & _
                         "Account Legal Name: " & wResult.Cells(i, 2).Value & vbCrLf & _
                         "Trade ID: " & wResult.Cells(i, 3).Value & vbCrLf & _
                         "Trade Data Entity: " & wResult.Cells(i, 4).Value & vbCrLf & _
                         "Logic Table Entity: " & wResult.Cells(i, 5).Value & vbCrLf & _
                         "Quantity: " & wResult.Cells(i, 6).Value & vbCrLf & _
                         "Security Description: " & wResult.Cells(i, 7).Value & vbCrLf & _
                         "Settle Date: " & wResult.Cells(i, 8).Value & vbCrLf & vbCrLf
        End If
    Next i
    
    ' Clear the filter and helper column
    wResult.AutoFilterMode = False
    wResult.Columns("I:I").ClearContents
    
    ' Create Outlook Application
    Set outlookApp = CreateObject("Outlook.Application")
    
    ' Check if there are mismatching rows before creating an email
    If Len(emailBody) > Len("Mismatching Entities Details:" & vbCrLf & vbCrLf) Then
        ' Create a new mail item
        Set outlookMail = outlookApp.CreateItem(0)
        
        ' Customize email properties
        With outlookMail
            .Subject = "T+0 UST Entity Matches - Regulatory/Financial Impact"
            .Body = emailBody & vbCrLf & "Please wash today as per Logic Table Entity Stated."
            
            ' Add recipients' email addresses
            .Recipients.Add "xratcubondprocessing@barclays.com"
            .Recipients.Add "usratescashtatcu@barclays.com"
            
            ' Display the email
            .Display
        End With
    End If
    
    ' Release Outlook objects
    Set outlookMail = Nothing
    Set outlookApp = Nothing
End Sub