
Sub GenerateEmailsForUSTreasuryWI()
    Dim wsTrade As Worksheet
    Dim lastRow As Long
    Dim issuerAbbrevCol As Integer
    Dim i As Long
    Dim outlookApp As Object
    Dim outlookMail As Object
    Dim emailBody As String
    
    ' Set worksheet
    Set wsTrade = ThisWorkbook.Sheets("TradeData")
    
    ' Set column numbers based on desired headers
    issuerAbbrevCol = WorksheetFunction.Match("Issuer Abbrev", wsTrade.Rows(1), 0)
    
    ' Find the last row in the sheet
    lastRow = wsTrade.Cells(wsTrade.Rows.Count, issuerAbbrevCol).End(xlUp).Row
    
    ' Create Outlook Application
    Set outlookApp = CreateObject("Outlook.Application")
    
    ' Loop through each row in "Issuer Abbrev" column
    For i = 2 To lastRow
        ' Check if the value begins with "US Treasury WI"
        If Left(wsTrade.Cells(i, issuerAbbrevCol).Value, 14) = "US Treasury WI" Then
            ' Generate HTML-formatted email body
            emailBody = "<html><body>"
            emailBody = emailBody & "<p><strong>Trade ID:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Trade ID", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Quantity:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Quantity", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>BARC Direction:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("BARC Direction", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Security Description:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Security Description", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Clean Price:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Clean Price", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Settle Date:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Settle Date", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Issuer Abbrev:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Issuer Abbrev", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Dirty Price:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Dirty Price", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Trade Date:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Trade Date", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Creation Time:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Creation Time", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Ticker:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Ticker", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Mat Date:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Mat Date", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Net:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Net", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>CUSIP:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("CUSIP", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>ISIN:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("ISIN", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Security ID:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Security ID", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "<p><strong>Client Contact:</strong> " & wsTrade.Cells(i, WorksheetFunction.Match("Client Contact", wsTrade.Rows(1), 0)).Value & "</p>"
            emailBody = emailBody & "</body></html>"
            
            ' Create a new mail item
            Set outlookMail = outlookApp.CreateItem(0)
            
            ' Customize email properties
            With outlookMail
                .Subject = "Trade Details for US Treasury WI"
                .HTMLBody = emailBody
                .Recipients.Add "recipient@example.com" ' Add recipient's email address
                .Display
            End With
            
            ' Release Outlook mail object
            Set outlookMail = Nothing
        End If
    Next i
    
    ' Release Outlook application object
    Set outlookApp = Nothing
    
    MsgBox "Emails generated successfully!", vbInformation
End Sub