Sub CheckMatchingEntities()

    ' Define variables
    Dim wsResult As Worksheet
    Dim lastRowResult As Long
    Dim outlookApp As Object
    Dim outlookMail As Object
    
    ' Set worksheet
    Set wsResult = ThisWorkbook.Sheets("ResultSheet") ' Replace "ResultSheet" with the actual name of your sheet
    
    ' Find the last row in ResultSheet
    lastRowResult = wsResult.Cells(wsResult.Rows.Count, 1).End(xlUp).Row
    
    ' Create Outlook Application
    Set outlookApp = CreateObject("Outlook.Application")
    
    ' Loop through the rows in ResultSheet to check for matching entities
    For i = 2 To lastRowResult
        If wsResult.Cells(i, 4).Value = wsResult.Cells(i, 5).Value Then
            ' Entities match, generate email
            Set outlookMail = outlookApp.CreateItem(0)
            With outlookMail
                .Subject = "Matching Entities Detected"
                .Body = "Details of Matching Entities:" & vbCrLf & vbCrLf & _
                        "SDS: " & wsResult.Cells(i, 1).Value & vbCrLf & _
                        "Account Legal Name: " & wsResult.Cells(i, 2).Value & vbCrLf & _
                        "Trade ID: " & wsResult.Cells(i, 3).Value & vbCrLf & _
                        "Entity: " & wsResult.Cells(i, 4).Value & vbCrLf & _
                        "Logic Table Entity: " & wsResult.Cells(i, 5).Value
                ' Get the email contact from LogicTable Column H relative to SDS in Column A
                Dim contactEmail As String
                contactEmail = Application.VLookup(wsResult.Cells(i, 1).Value, ThisWorkbook.Sheets("LogicTable").Range("A:H"), 8, False)
                ' Add recipient's email address
                .Recipients.Add contactEmail
                ' Send the email
                .Send
            End With
        Else
            MsgBox "Row " & i & ": Entities do not match.", vbExclamation
        End If
    Next i

    ' Release Outlook objects
    Set outlookMail = Nothing
    Set outlookApp = Nothing

End Sub

