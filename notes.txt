Sub GenerateAndDisplayEmails()
    Dim outlookApp As Object
    Dim mailItem As Object
    Dim tradeDataSheet As Worksheet
    Dim ssiaffirmationSheet As Worksheet
    Dim tradeDataLastRow As Long
    Dim ssiaffirmationLastRow As Long
    Dim i As Long
    Dim emailBody As String

    ' Set the sheets
    Set tradeDataSheet = ThisWorkbook.Sheets("TradeData")
    Set ssiaffirmationSheet = ThisWorkbook.Sheets("SSIAffirmation")

    ' Find the last row with data in each sheet
    tradeDataLastRow = tradeDataSheet.Cells(tradeDataSheet.Rows.Count, "B").End(xlUp).Row
    ssiaffirmationLastRow = ssiaffirmationSheet.Cells(ssiaffirmationSheet.Rows.Count, "B").End(xlUp).Row

    ' Create Outlook Application object
    On Error Resume Next
    Set outlookApp = GetObject(, "Outlook.Application")
    On Error GoTo 0

    If outlookApp Is Nothing Then
        Set outlookApp = CreateObject("Outlook.Application")
    End If

    ' Loop through TradeData sheet
    For i = 2 To tradeDataLastRow
        Dim tradeDataValue As Variant
        tradeDataValue = tradeDataSheet.Cells(i, "BI").Value

        ' Check if the value is found in SSIAffirmation sheet
        Dim matchIndex As Variant
        matchIndex = Application.Match(tradeDataValue, ssiaffirmationSheet.Range("B2:B" & ssiaffirmationLastRow), 0)

        If Not IsError(matchIndex) Then
            ' If found, get the corresponding value from column C in SSIAffirmation sheet
            Dim ssiaffirmationValue As Variant
            ssiaffirmationValue = ssiaffirmationSheet.Cells(matchIndex, "C").Value

            ' Get the value from column AD in TradeData sheet
            Dim adValue As Variant
            adValue = tradeDataSheet.Cells(i, "AD").Value

            ' Generate email body
            emailBody = "Dear User," & vbCrLf & vbCrLf
            emailBody = emailBody & "Details from TradeData sheet:" & vbCrLf
            emailBody = emailBody & "Column E: " & tradeDataSheet.Cells(i, "E").Value & vbCrLf
            emailBody = emailBody & "Column G: " & tradeDataSheet.Cells(i, "G").Value & vbCrLf
            emailBody = emailBody & "Column H: " & tradeDataSheet.Cells(i, "H").Value & vbCrLf
            emailBody = emailBody & "Column O: " & tradeDataSheet.Cells(i, "O").Value & vbCrLf
            emailBody = emailBody & "Column T: " & tradeDataSheet.Cells(i, "T").Value & vbCrLf
            emailBody = emailBody & "Column AD: " & adValue & vbCrLf
            emailBody = emailBody & "Column AF: " & tradeDataSheet.Cells(i, "AF").Value & vbCrLf
            emailBody = emailBody & "Column AW: " & tradeDataSheet.Cells(i, "AW").Value & vbCrLf & vbCrLf

            ' Create a new mail item
            Set mailItem = outlookApp.CreateItem(0)

            ' Set email properties
            mailItem.Subject = "Trade Data Details"
            mailItem.Body = emailBody

            ' Set the recipient email address
            mailItem.To = ssiaffirmationValue

            ' Display the email
            mailItem.Display
        End If
    Next i

    ' Clean up
    Set tradeDataSheet = Nothing
    Set ssiaffirmationSheet = Nothing
    Set outlookApp = Nothing
    Set mailItem = Nothing
End Sub
