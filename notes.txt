Sub SendEmailToClients()

    ' Define variables
    Dim wsTrade As Worksheet
    Dim wsLogic As Worksheet
    Dim lastRowTrade As Long
    Dim tradeSDSCol As Integer
    Dim logicSDSCol As Integer
    Dim outlookApp As Object
    Dim outlookMail As Object
    
    ' Set worksheets
    Set wsTrade = ThisWorkbook.Sheets("TradeData")
    Set wsLogic = ThisWorkbook.Sheets("LogicTable")
    
    ' Set column numbers based on headers
    tradeSDSCol = WorksheetFunction.Match("SDS", wsTrade.Rows(1), 0)
    logicSDSCol = WorksheetFunction.Match("SDS", wsLogic.Rows(1), 0)
    
    ' Find the last row in each sheet
    lastRowTrade = wsTrade.Cells(wsTrade.Rows.Count, tradeSDSCol).End(xlUp).Row
    
    ' Create Outlook Application
    Set outlookApp = CreateObject("Outlook.Application")

    ' Loop through TradeData sheet
    For i = 2 To lastRowTrade
        ' Search for SDS value in LogicTable
        Dim foundCell As Range
        Set foundCell = wsLogic.Columns(logicSDSCol).Find(wsTrade.Cells(i, tradeSDSCol).Value, LookIn:=xlValues, LookAt:=xlWhole)
        
        ' If a match is found, send email to the client
        If Not foundCell Is Nothing Then
            ' Create a new mail item
            Set outlookMail = outlookApp.CreateItem(0)
            
            ' Customize email properties
            With outlookMail
                .Subject = "Trade Details - Entity Matched"
                .Body = "Trade details for the entity-matched trade:" & vbCrLf & vbCrLf
                
                ' Add trade details to email body
                For col = 1 To wsTrade.Columns.Count
                    .Body = .Body & wsTrade.Cells(i, col).Value & vbCrLf
                Next col
                
                ' Add recipient's email address from LogicTable column H
                .Recipients.Add foundCell.Offset(0, 7).Value
                
                ' Send the email
                .Send
            End With
        End If
    Next i

    ' Release Outlook objects
    Set outlookMail = Nothing
    Set outlookApp = Nothing

End Sub
