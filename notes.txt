Sub MatchAndCopyToCSColumn()
    Dim wsTrade As Worksheet
    Dim wsLogicTable As Worksheet
    Dim lastRowTrade As Long
    Dim lastRowLogicTable As Long
    Dim counterpartyIDHeader As Range
    Dim rngCounterpartyID As Range
    Dim rngLogicTable As Range
    Dim logicTableDict As Object
    Dim i As Long

    ' Set worksheets
    Set wsTrade = ThisWorkbook.Sheets("TradeData") ' Replace "TradeData" with the actual name of your trade data sheet
    Set wsLogicTable = ThisWorkbook.Sheets("LogicTable") ' Replace "LogicTable" with the actual name of your logic table sheet

    ' Find "Counterparty ID" column header in "TradeData" sheet
    On Error Resume Next
    Set counterpartyIDHeader = wsTrade.Rows(1).Find("Counterparty ID", LookIn:=xlValues)
    On Error GoTo 0

    ' Check if header is found in "TradeData" sheet
    If Not counterpartyIDHeader Is Nothing Then
        ' Set range for "Counterparty ID" column in "TradeData" sheet
        Set rngCounterpartyID = wsTrade.Columns(counterpartyIDHeader.Column)

        ' Find the last row in "TradeData" sheet
        lastRowTrade = wsTrade.Cells(wsTrade.Rows.Count, rngCounterpartyID.Column).End(xlUp).Row

        ' Set range for "LogicTable" data
        Set rngLogicTable = wsLogicTable.Range("A:D")

        ' Create a dictionary to store LogicTable values for faster lookup
        Set logicTableDict = CreateObject("Scripting.Dictionary")
        For i = 2 To rngLogicTable.Rows.Count
            logicTableDict(rngLogicTable.Cells(i, 1).Value) = rngLogicTable.Cells(i, 4).Value
        Next i

        ' Loop through each row in "TradeData" sheet
        For i = 2 To lastRowTrade
            ' Check if Counterparty ID exists in LogicTable
            If logicTableDict.Exists(rngCounterpartyID.Cells(i, 1).Value) Then
                ' Copy corresponding value from LogicTable to TradeData
                wsTrade.Cells(i, "CS").Value = logicTableDict(rngCounterpartyID.Cells(i, 1).Value)
            End If
        Next i

        ' Display a message (you can modify this part as needed)
        MsgBox "Values copied to column CS in 'TradeData' sheet.", vbInformation
    Else
        MsgBox "Column header 'Counterparty ID' not found in 'TradeData' sheet!", vbExclamation
    End If
End Sub
