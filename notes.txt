Sub ImportDataFromExtractsFolder()
    Dim folderPath As String
    Dim fileName As String
    Dim wsMaster As Worksheet
    Dim wsTemp As Worksheet
    Dim lastRow As Long
    Dim headerRange As Range
    Dim sourceWorkbook As Workbook
    
    ' Set the folder path
    folderPath = ThisWorkbook.Path & "\Extracts\"
    
    ' Set the master sheet
    Set wsMaster = ThisWorkbook.Sheets("master")
    
    ' Create a temporary sheet to store each file's data
    Set wsTemp = ThisWorkbook.Sheets.Add
    
    ' Find the header range in the master sheet
    On Error Resume Next
    Set headerRange = wsMaster.Rows(1).Find("*", LookIn:=xlValues, LookAt:=xlWhole)
    On Error GoTo 0
    
    ' Loop through each file in the Extracts folder
    fileName = Dir(folderPath & "*.*")
    
    Do While fileName <> ""
        If fileName <> ThisWorkbook.Name Then ' Skip the current workbook
            ' Clear temporary sheet
            wsTemp.Cells.Clear
            
            ' Attempt to open the file
            On Error Resume Next
            Set sourceWorkbook = Workbooks.Open(folderPath & fileName)
            On Error GoTo 0
            
            If Not sourceWorkbook Is Nothing Then
                ' Copy data to the temporary sheet
                sourceWorkbook.Sheets(1).UsedRange.Copy wsTemp.Cells(1, 1)
                
                ' Close the source workbook without saving changes
                sourceWorkbook.Close SaveChanges:=False
                
                ' Check if headers are already present in the master sheet
                If headerRange Is Nothing Then
                    ' Find the last non-empty row in the master sheet
                    lastRow = wsMaster.Cells(wsMaster.Rows.Count, "A").End(xlUp).Row
                Else
                    ' Headers are already present, so find the last non-empty row starting from row 2
                    lastRow = wsMaster.Cells(wsMaster.Rows.Count, "A").End(xlUp).Row
                    If lastRow > 1 Then
                        Do While Application.CountA(wsMaster.Rows(lastRow)) = 0
                            lastRow = lastRow - 1
                        Loop
                    End If
                End If
                
                ' Copy data from the temporary sheet to the master sheet (excluding the last row if it contains "null" values)
                If Application.CountA(wsTemp.Rows(wsTemp.UsedRange.Rows.Count)) > 0 Then
                    wsTemp.UsedRange.Copy wsMaster.Cells(lastRow + 1, 1)
                End If
            Else
                MsgBox "Error opening workbook: " & folderPath & fileName, vbExclamation
            End If
        End If
        
        ' Get the next file
        fileName = Dir
    Loop
    
    ' Delete the temporary sheet
    Application.DisplayAlerts = False
    wsTemp.Delete
    Application.DisplayAlerts = True
End Sub

