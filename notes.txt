Sub CreateSectorAnalysis()
    Dim wsAllOfferings As Worksheet
    Dim wsOverview As Worksheet
    Dim lastRow As Long
    Dim uniqueSectors As Collection
    Dim sector As Variant
    Dim i As Long

    ' Set references to sheets
    On Error Resume Next
    Set wsAllOfferings = ThisWorkbook.Sheets("All Offerings")
    On Error GoTo 0

    If wsAllOfferings Is Nothing Then
        MsgBox "Sheet 'All Offerings' not found!", vbExclamation
        Exit Sub
    End If

    ' Check if "Overview" sheet already exists, if yes, delete it
    On Error Resume Next
    Application.DisplayAlerts = False
    Set wsOverview = ThisWorkbook.Sheets("Overview")
    On Error GoTo 0
    Application.DisplayAlerts = True

    If Not wsOverview Is Nothing Then
        Application.DisplayAlerts = False
        wsOverview.Delete
        Application.DisplayAlerts = True
    End If

    ' Create a new sheet named "Overview"
    Set wsOverview = Sheets.Add(After:=Sheets(Sheets.Count))
    wsOverview.Name = "Overview"

    ' Find the last row in the "All Offerings" sheet
    lastRow = wsAllOfferings.Cells(wsAllOfferings.Rows.Count, "A").End(xlUp).Row

    ' Copy headers to the "Overview" sheet
    wsAllOfferings.Rows(1).Copy wsOverview.Rows(1)

    ' Add headers for sector analysis
    wsOverview.Cells(1, 4).Value = "Sector Analysis"

    ' Find unique sectors
    Set uniqueSectors = New Collection
    On Error Resume Next
    For i = 2 To lastRow
        uniqueSectors.Add wsAllOfferings.Cells(i, 24).Value, CStr(wsAllOfferings.Cells(i, 24).Value)
    Next i
    On Error GoTo 0

    ' Display unique sectors and calculate sector metrics
    wsOverview.Cells(2, 4).Value = "Sector"
    wsOverview.Cells(2, 5).Value = "Number of Offerings"
    wsOverview.Cells(2, 6).Value = "Total Offer Amount (MM)"
    wsOverview.Cells(2, 7).Value = "Average Discount"
    wsOverview.Cells(2, 8).Value = "Total Maturity Value (MM)"
    wsOverview.Cells(2, 9).Value = "Average Days to Maturity (DTM)"
    wsOverview.Cells(2, 10).Value = "Total Net Upfront (MM)"

    For i = 1 To uniqueSectors.Count
        sector = uniqueSectors(i)

        wsOverview.Cells(i + 2, 4).Value = sector
        wsOverview.Cells(i + 2, 5).Formula = "=COUNTIFS('All Offerings'!Y:Y,""" & sector & """)"
        wsOverview.Cells(i + 2, 6).Formula = "=SUMIFS('All Offerings'!B:B, 'All Offerings'!Y:Y,""" & sector & """)"
        wsOverview.Cells(i + 2, 7).Formula = "=AVERAGEIFS('All Offerings'!C:C, 'All Offerings'!Y:Y,""" & sector & """)"
        wsOverview.Cells(i + 2, 8).Formula = "=SUMIFS('All Offerings'!B:B*(1+'All Offerings'!C:C/100), 'All Offerings'!Y:Y,""" & sector & """)"
        wsOverview.Cells(i + 2, 9).Formula = "=AVERAGEIFS('All Offerings'!D:D, 'All Offerings'!Y:Y,""" & sector & """)"
        wsOverview.Cells(i + 2, 10).Formula = "=SUMIFS('All Offerings'!V:V, 'All Offerings'!Y:Y,""" & sector & """)"
    Next i

    ' Format the "Overview" sheet
    wsOverview.Columns.AutoFit

    MsgBox "Sector Analysis completed successfully!", vbInformation
End Sub
