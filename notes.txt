Sub AnalyseRatings()
    ' Declare variables
    Dim wsAllOfferings As Worksheet
    Dim wsOverview As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim clientCategory As String
    Dim spRatingSum As Double
    Dim moodyRatingSum As Double
    Dim fitchRatingSum As Double
    Dim spRatingCount As Long
    Dim moodyRatingCount As Long
    Dim fitchRatingCount As Long
    Dim uniqueCategories As Collection
    
    ' Set references to worksheets
    Set wsAllOfferings = ThisWorkbook.Sheets("All Offerings")
    Set wsOverview = ThisWorkbook.Sheets("Overview")
    
    ' Clear existing data in Overview sheet
    wsOverview.Rows("2:" & wsOverview.Rows.Count).Clear
    
    ' Find the last row in All Offerings sheet
    lastRow = wsAllOfferings.Cells(wsAllOfferings.Rows.Count, "A").End(xlUp).Row
    
    ' Initialize variables
    Set uniqueCategories = New Collection
    
    ' Loop through All Offerings data
    For i = 2 To lastRow ' Assuming the headers are in the first row
        
        ' Get client category code
        clientCategory = wsAllOfferings.Cells(i, 8).Value
        
        ' Check if client category is not already added to the collection
        On Error Resume Next
        uniqueCategories.Add clientCategory, CStr(clientCategory)
        On Error GoTo 0
        
        ' Sum ratings based on agency and reg type
        spRatingSum = spRatingSum + wsAllOfferings.Cells(i, 9).Value
        moodyRatingSum = moodyRatingSum + wsAllOfferings.Cells(i, 10).Value
        fitchRatingSum = fitchRatingSum + wsAllOfferings.Cells(i, 11).Value
        
        ' Count ratings based on agency and reg type
        spRatingCount = spRatingCount + 1
        moodyRatingCount = moodyRatingCount + 1
        fitchRatingCount = fitchRatingCount + 1
        
    Next i
    
    ' Populate Overview sheet with unique categories
    wsOverview.Range("I2").Resize(uniqueCategories.Count, 1).Value = WorksheetFunction.Transpose(uniqueCategories.Items)
    
    ' Calculate average ratings and populate Overview sheet
    wsOverview.Range("J2").Resize(uniqueCategories.Count, 1).Formula = "=SUMIFS('All Offerings'!I:I, 'All Offerings'!H:H, Overview!I2)/COUNTIFS('All Offerings'!I:I, 'All Offerings'!H:H, Overview!I2)"
    
    wsOverview.Range("K2").Resize(uniqueCategories.Count, 1).Formula = "=SUMIFS('All Offerings'!J:J, 'All Offerings'!H:H, Overview!I2)/COUNTIFS('All Offerings'!J:J, 'All Offerings'!H:H, Overview!I2)"
    
    wsOverview.Range("L2").Resize(uniqueCategories.Count, 1).Formula = "=SUMIFS('All Offerings'!K:K, 'All Offerings'!H:H, Overview!I2)/COUNTIFS('All Offerings'!K:K, 'All Offerings'!H:H, Overview!I2)"
    
    ' Copy other relevant data from All Offerings to Overview
    wsOverview.Range("A2:H2").Value = wsAllOfferings.Range("A1:H1").Value
    
End Sub
