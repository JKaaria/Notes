Sub SendEmailToContact()

    ' Define variables
    Dim wsResults As Worksheet
    Dim wsLogic As Worksheet
    Dim counterpartyHeader As Range
    Dim logicTableContact As Range
    Dim lastCellRow As Long
    Dim counterpartyValue As Variant
    Dim contactEmail As String
    Dim tradeDetails As String
    Dim outlookApp As Object
    Dim outlookMail As Object
    
    ' Set worksheets
    Set wsResults = ThisWorkbook.Sheets("ResultsSheet")
    Set wsLogic = ThisWorkbook.Sheets("LogicTable") ' Replace with actual name of your logic table sheet
    
    ' Find "Counterparty" column header in "ResultsSheet"
    On Error Resume Next
    Set counterpartyHeader = wsResults.Rows(1).Find("Counterparty", LookIn:=xlValues)
    On Error GoTo 0
    
    ' Check if header is found
    If Not counterpartyHeader Is Nothing Then
        ' Get the value in the last cell of the row for "Counterparty" in "ResultsSheet"
        lastCellRow = wsResults.Cells(wsResults.Rows.Count, counterpartyHeader.Column).End(xlUp).Row
        counterpartyValue = wsResults.Cells(lastCellRow, counterpartyHeader.Column).Value
        
        ' Look up the corresponding contact in "LogicTable"
        Set logicTableContact = wsLogic.Columns("E").Find(counterpartyValue, LookIn:=xlValues)
        
        ' Check if contact is found
        If Not logicTableContact Is Nothing Then
            ' Get the email address from the last cell of the row in "LogicTable" column E
            contactEmail = wsLogic.Cells(logicTableContact.Row, "E").Value
            
            ' Create the trade details string
            tradeDetails = "Account Legal Name: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("Account Legal Name").Column).Value & vbCrLf & _
                           "Settle Legal Entity: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("Settle Legal Entity").Column).Value & vbCrLf & _
                           "Trade ID: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("Trade ID").Column).Value & vbCrLf & _
                           "BARC Direction: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("BARC Direction").Column).Value & vbCrLf & _
                           "Quantity: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("Quantity").Column).Value & vbCrLf & _
                           "Security Description: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("Security Description").Column).Value & vbCrLf & _
                           "Clean Price: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("Clean Price").Column).Value & vbCrLf & _
                           "Settle Date: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("Settle Date").Column).Value & vbCrLf & _
                           "Mat Date: " & wsResults.Cells(lastCellRow, wsResults.Rows(1).Find("Mat Date").Column).Value
            
            ' Create Outlook objects
            Set outlookApp = CreateObject("Outlook.Application")
            Set outlookMail = outlookApp.CreateItem(0)
            
            ' Set email details
            With outlookMail
                .To = contactEmail
                .Subject = "Trade Details"
                .Body = tradeDetails
                .Display ' Use .Send to send without displaying
            End With
            
            ' Display a message (you can modify this part as needed)
            MsgBox "Email sent to contact: " & contactEmail, vbInformation
        Else
            MsgBox "Contact not found in LogicTable!", vbExclamation
        End If
    Else
        MsgBox "Column header 'Counterparty' not found in ResultsSheet!", vbExclamation
    End If

End Sub

