Sub SendTradeDataEmails()
    Dim wsTradeData As Worksheet
    Dim wsSSIAffirmation As Worksheet
    Dim lastRowTradeData As Long
    Dim lastColTradeData As Long
    Dim outlookApp As Object
    Dim outlookMail As Object
    Dim i As Long, j As Long

    ' Set worksheets
    Set wsTradeData = ThisWorkbook.Sheets("TradeData")
    Set wsSSIAffirmation = ThisWorkbook.Sheets("SSIAffirmation")

    ' Find the last row and last column in the TradeData sheet
    lastRowTradeData = wsTradeData.Cells(wsTradeData.Rows.Count, "A").End(xlUp).Row
    lastColTradeData = wsTradeData.Cells(1, wsTradeData.Columns.Count).End(xlToLeft).Column

    ' Create Outlook Application
    Set outlookApp = CreateObject("Outlook.Application")

    ' Loop through each row in the TradeData sheet
    For i = 2 To lastRowTradeData ' Assuming data starts from row 2, change as needed
        ' Loop through each column in the TradeData sheet
        For j = 3 To lastColTradeData ' Assuming data starts from column C, change as needed
            ' Check if the value in TradeData column BI matches SSIAffirmation column C
            If wsTradeData.Cells(i, j).Value = wsSSIAffirmation.Cells(i - 1, "C").Value Then
                ' Create a new mail item
                Set outlookMail = outlookApp.CreateItem(0)

                ' Customize email properties
                With outlookMail
                    ' Build the subject with a "-" between values in SSIAffirmation columns A and B
                    .Subject = wsSSIAffirmation.Cells(i - 1, "A").Value & " - " & wsSSIAffirmation.Cells(i - 1, "B").Value & " UST SSI Affirmation"

                    ' Build the email body
                    Dim emailBody As String
                    emailBody = "Row " & i - 1 & ":" & vbCrLf & _
                                " SDS: " & wsTradeData.Cells(i, 1).Value & vbCrLf & _
                                " Account Legal Name: " & wsTradeData.Cells(i, 2).Value & vbCrLf & _
                                " Trade ID: " & wsTradeData.Cells(i, 3).Value & vbCrLf & _
                                " Trade Data Entity: " & wsTradeData.Cells(i, j).Value & vbCrLf & _
                                " Logic Table Entity: " & wsTradeData.Cells(i, j + 1).Value & vbCrLf & _
                                " Quantity: " & wsTradeData.Cells(i, j + 2).Value & vbCrLf & _
                                " Security Description: " & wsTradeData.Cells(i, j + 3).Value & vbCrLf & _
                                " Settle Date: " & wsTradeData.Cells(i, j + 4).Value & vbCrLf & vbCrLf

                    ' Add the recipient's email address
                    .Recipients.Add wsSSIAffirmation.Cells(i - 1, "C").Value

                    ' Add the email body
                    .Body = emailBody

                    ' Display the email
                    .Display
                End With

                ' Release Outlook objects
                Set outlookMail = Nothing
            End If
        Next j
    Next i

    ' Release Outlook Application
    Set outlookApp = Nothing
End Sub

