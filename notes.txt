Sub ProcessTradeData()
    Dim wsTradeData As Worksheet
    Dim wsT0WIBookings As Worksheet
    Dim lastRowTradeData As Long
    Dim tradeDateCol As Range
    Dim mostRecentDate As Date
    Dim tradeDateColumnIndex As Long
    Dim targetRow As Long
    
    ' Set the worksheets
    Set wsTradeData = ThisWorkbook.Sheets("TradeData")
    Set wsT0WIBookings = ThisWorkbook.Sheets("T+0 WI Bookings")
    
    ' Find the last row in the TradeData sheet
    lastRowTradeData = wsTradeData.Cells(wsTradeData.Rows.Count, 1).End(xlUp).Row
    
    ' Find the column index of the "Trade Date" column (assumes it's in the first row)
    tradeDateColumnIndex = 0
    For i = 1 To wsTradeData.Cells(1, wsTradeData.Columns.Count).End(xlToLeft).Column
        If wsTradeData.Cells(1, i).Value = "Trade Date" Then
            tradeDateColumnIndex = i
            Exit For
        End If
    Next i
    
    ' Check if "Trade Date" column was found
    If tradeDateColumnIndex = 0 Then
        MsgBox "The 'Trade Date' column was not found.", vbExclamation
        Exit Sub
    End If
    
    ' Set the range for the "Trade Date" column
    Set tradeDateCol = wsTradeData.Range(wsTradeData.Cells(2, tradeDateColumnIndex), wsTradeData.Cells(lastRowTradeData, tradeDateColumnIndex))
    
    ' Initialize mostRecentDate with the first date in the column
    mostRecentDate = tradeDateCol.Cells(1, 1).Value
    
    ' Loop through each cell in the "Trade Date" column
    For Each cell In tradeDateCol
        If IsDate(cell.Value) Then
            ' Check if the current cell's date is greater than the current mostRecentDate
            If cell.Value > mostRecentDate Then
                mostRecentDate = cell.Value
            End If
        End If
    Next cell
    
    ' Display the most recent date in a pop-up message box
    MsgBox "The most recent trade date is: " & Format(mostRecentDate, "DD/MM/YY"), vbInformation
    
    ' Call the subroutine to append rows to T+0 WI Bookings based on mostRecentDate
    AppendRowsToT0WIBookings wsTradeData, wsT0WIBookings, mostRecentDate
End Sub

Sub AppendRowsToT0WIBookings(wsTradeData As Worksheet, wsT0WIBookings As Worksheet, mostRecentDate As Date)
    Dim lastRowTradeData As Long
    Dim tradeDateCol As Range
    Dim tradeDateColumnIndex As Long
    Dim targetRow As Long
    
    ' Find the last row in the TradeData sheet
    lastRowTradeData = wsTradeData.Cells(wsTradeData.Rows.Count, 1).End(xlUp).Row
    
    ' Find the column index of the "Trade Date" column (assumes it's in the first row)
    tradeDateColumnIndex = 0
    For i = 1 To wsTradeData.Cells(1, wsTradeData.Columns.Count).End(xlToLeft).Column
        If wsTradeData.Cells(1, i).Value = "Trade Date" Then
            tradeDateColumnIndex = i
            Exit For
        End If
    Next i
    
    ' Check if "Trade Date" column was found
    If tradeDateColumnIndex = 0 Then
        MsgBox "The 'Trade Date' column was not found.", vbExclamation
        Exit Sub
    End If
    
    ' Set the range for the "Trade Date" column
    Set tradeDateCol = wsTradeData.Range(wsTradeData.Cells(2, tradeDateColumnIndex), wsTradeData.Cells(lastRowTradeData, tradeDateColumnIndex))
    
    ' Loop through each cell in the "Trade Date" column
    For Each cell In tradeDateCol
        If IsDate(cell.Value) Then
            ' Check if the current cell's date is equal to the mostRecentDate
            If cell.Value = mostRecentDate Then
                ' Find the target row in the T+0 WI Bookings sheet
                targetRow = wsT0WIBookings.Cells(wsT0WIBookings.Rows.Count, 1).End(xlUp).Row + 1
                
                ' Copy the entire row from TradeData to T+0 WI Bookings
                wsTradeData.Rows(cell.Row).Copy wsT0WIBookings.Rows(targetRow)
            End If
        End If
    Next cell
End Sub

