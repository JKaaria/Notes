Sub HighlightRecBreaks()

    ' Define variables
    Dim wsTrade As Worksheet
    Dim wsLogic As Worksheet
    Dim lastRowTrade As Long
    Dim lastRowLogic As Long
    Dim tradeCounterpartyIDCol As Integer
    Dim logicSDSCol As Integer
    Dim tradeSettleLegalEntityCol As Integer
    Dim logicEntityCol As Integer
    Dim i As Long, j As Long
    Dim rngToHighlight As Range
    
    ' Set worksheets
    Set wsTrade = ThisWorkbook.Sheets("TradeData")
    Set wsLogic = ThisWorkbook.Sheets("LogicTable")
    
    ' Set column numbers based on headers
    tradeCounterpartyIDCol = WorksheetFunction.Match("Counterparty ID", wsTrade.Rows(1), 0)
    logicSDSCol = WorksheetFunction.Match("SDS", wsLogic.Rows(1), 0)
    tradeSettleLegalEntityCol = WorksheetFunction.Match("Settle Legal Entity", wsTrade.Rows(1), 0)
    logicEntityCol = WorksheetFunction.Match("Entity", wsLogic.Rows(1), 0)
    
    ' Find the last rows in each sheet
    lastRowTrade = wsTrade.Cells(wsTrade.Rows.Count, tradeCounterpartyIDCol).End(xlUp).Row
    lastRowLogic = wsLogic.Cells(wsLogic.Rows.Count, logicSDSCol).End(xlUp).Row
    
    ' Initialize the range to highlight
    Set rngToHighlight = Nothing
    
    ' Loop through TradeData sheet
    For i = 2 To lastRowTrade
        ' Loop through LogicTable sheet
        For j = 2 To lastRowLogic
            ' Check if Counterparty ID matches SDS
            If wsTrade.Cells(i, tradeCounterpartyIDCol).Value = wsLogic.Cells(j, logicSDSCol).Value Then
                ' If match, check if Settle Legal Entity matches Entity
                If wsTrade.Cells(i, tradeSettleLegalEntityCol).Value <> wsLogic.Cells(j, logicEntityCol).Value Then
                    ' If not matching, add the row to the range to highlight
                    If rngToHighlight Is Nothing Then
                        Set rngToHighlight = wsTrade.Rows(i)
                    Else
                        Set rngToHighlight = Union(rngToHighlight, wsTrade.Rows(i))
                    End If
                End If
                Exit For ' Exit inner loop after matching Counterparty ID
            End If
        Next j
    Next i
    
    ' Highlight the identified rows in red
    If Not rngToHighlight Is Nothing Then
        rngToHighlight.Interior.Color = RGB(255, 0, 0) ' Red color
    End If
    
    MsgBox "Highlighting complete!", vbInformation

End Sub
